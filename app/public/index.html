<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>アンケートトップ</title>
  </head>
  <body>
    <h1>メニュー選択</h1>
    <button type="button" id="makeButton">アンケート作成</button>
    <button type="button" id="resultButton">アンケート結果確認</button>
    <button type="button" id="answerButton">アンケート回答</button>
    <p id="response"></p>

    <!-- 結果を表示するためのセクション -->
    <div id="resultsContainer" style="margin-top: 20px">
      <div id="title"></div>
      <div id="question" style="height: auto; width: auto"></div>
      <div id="result"></div>
    </div>

    <script>
      // アンケート作成ページ遷移
      const makeButton = document.getElementById("makeButton");
      if (makeButton) {
        makeButton.addEventListener("click", () => {
          window.location.href = "/create";
        });
      } else {
        console.error("アンケート作成ボタンが見つかりません。");
      }

      // アンケート結果取得と表示
      const resultButton = document.getElementById("resultButton");
      if (resultButton) {
        resultButton.addEventListener("click", async () => {
          const resultsContainer = document.getElementById("resultsContainer");
          const titleContainer = document.getElementById("title");
          const resultContainer = document.getElementById("result");
          const questionContainer = document.getElementById("question");
          titleContainer.innerHTML = "データを取得しています...";

          try {
            const response = await fetch("/results");
            if (!response.ok) {
              throw new Error("データの取得に失敗しました");
            }
            const results = await response.json();
            console.log(results.ans);
            console.log(results.question);
            // 結果を表示
            titleContainer.innerHTML = `<h2>${results.ans[0].question_title}</h2>\n`;
            questionContainer.innerHTML = `回答者\n`;
            results.question[0].json.date.forEach((question) => {
              if (question === null) {
                questionContainer.innerHTML += `<p>回答無し</p>\n`;
              } else {
                questionContainer.innerHTML += `<p style = "width: 50px;">${Object.values(question)}</p>\n`;
              }
            });

            results.ans.forEach((answers) => {
              const ansdiv = document.createElement("div");
              resultContainer.appendChild(ansdiv);
              console.log(answers.name);
              ansdiv.innerHTML = `${answers.name}`;
              answers.answers.forEach((ans) => {
                if (ans === null) {
                  ansdiv.innerHTML += `<p>回答無し</p>\n`;
                } else {
                  ansdiv.innerHTML += `<p>${ans}</p>\n`;
                }
              });
            });
          } catch (error) {
            console.error("エラー:", error);
            resultContainer.innerHTML = "結果の取得中にエラーが発生しました。";
          }
        });
      } else {
        console.error("結果確認ボタンが見つかりません。");
      }
    </script>
  </body>
</html>
